<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>iapp上传图片到云函数</title>
      <link href="/iapp%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E5%88%B0%E4%BA%91%E5%87%BD%E6%95%B0/"/>
      <url>/iapp%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E5%88%B0%E4%BA%91%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="iapp上传图片到腾讯云函数"><a href="#iapp上传图片到腾讯云函数" class="headerlink" title="iapp上传图片到腾讯云函数"></a>iapp上传图片到腾讯云函数</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>原理：使用iapp对图片进行Base64编码然后上传到腾讯云API网关触发云函数事件</p><h2 id="1-iapp对图片进行base64处理"><a href="#1-iapp对图片进行base64处理" class="headerlink" title="1.iapp对图片进行base64处理"></a>1.iapp对图片进行base64处理</h2><h3 id="使用httpbin-org对图片数据进行处理"><a href="#使用httpbin-org对图片数据进行处理" class="headerlink" title="使用httpbin.org对图片数据进行处理"></a>使用httpbin.org对图片数据进行处理</h3><h4 id="事件代码"><a href="#事件代码" class="headerlink" title="事件代码"></a>事件代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">t()</span><br><span class="line">&#123;</span><br><span class="line">  s api = <span class="string">&quot;http://httpbin.org/post&quot;</span></span><br><span class="line">  <span class="comment">// 因为huf函数使用post请求所以要使用httpbin post链接</span></span><br><span class="line">  s file = <span class="string">&quot;/storage/emulated/0/Pictures/WeiXin/1.jpg&quot;</span></span><br><span class="line">  <span class="comment">// 图片本地地址 如无法上传 使用%代替/storage/emulated/0/</span></span><br><span class="line">  s type = <span class="string">&quot;utf-8&quot;</span></span><br><span class="line">  <span class="comment">// 编码</span></span><br><span class="line">  huf(api, <span class="string">&quot;&quot;</span> , file, type, e)</span><br><span class="line">  syso(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="返回结果"><a href="#返回结果" class="headerlink" title="返回结果"></a>返回结果</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;args&quot;</span>: &#123;&#125;,</span><br><span class="line"><span class="attr">&quot;data&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;files&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;file&quot;</span>: <span class="string">&quot;data:image/jpeg;base64,图片数据&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;form&quot;</span>: &#123;&#125;,</span><br><span class="line"><span class="attr">&quot;headers&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip&quot;</span>,</span><br><span class="line"><span class="attr">&quot;Charset&quot;</span>: <span class="string">&quot;utf-8&quot;</span>,</span><br><span class="line"><span class="attr">&quot;Content-Length&quot;</span>: <span class="string">&quot;121&quot;</span>,</span><br><span class="line"><span class="attr">&quot;Content-Type&quot;</span>: <span class="string">&quot;multipart/form-data;boundary=******&quot;</span>,</span><br><span class="line"><span class="attr">&quot;Host&quot;</span>: <span class="string">&quot;httpbin.org&quot;</span>,</span><br><span class="line"><span class="attr">&quot;User-Agent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;X-Amzn-Trace-Id&quot;</span>: <span class="string">&quot;Root=1-6191e183-110116c866c95ea842fa6c2a&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;json&quot;</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">&quot;origin&quot;</span>: <span class="string">&quot;IP地址&quot;</span>,</span><br><span class="line"><span class="attr">&quot;url&quot;</span>: <span class="string">&quot;http://httpbin.org/post&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="云函数接收数据"><a href="#云函数接收数据" class="headerlink" title="云函数接收数据"></a>云函数接收数据</h3><h4 id="Python3-6"><a href="#Python3-6" class="headerlink" title="Python3.6"></a>Python3.6</h4><h5 id="进入控制台新建云函数"><a href="#进入控制台新建云函数" class="headerlink" title="进入控制台新建云函数"></a>进入<a href="https://console.cloud.tencent.com/scf/">控制台</a><a href="https://console.cloud.tencent.com/scf/list-create">新建云函数</a></h5><p><img src="https://i.loli.net/2021/11/15/KAdfrXO5InJ3DiE.png" alt="image.png"></p><h5 id="创建API网关触发"><a href="#创建API网关触发" class="headerlink" title="创建API网关触发"></a>创建API网关触发</h5><p>注意要<strong>不要</strong>勾选集成响应 否则下面的代码运行后会显示错误</p><p><img src="https://i.loli.net/2021/11/15/Xz43ibgGr716aQY.png" alt="image.png"></p><h5 id="云函数Python处理图片代码"><a href="#云函数Python处理图片代码" class="headerlink" title="云函数Python处理图片代码"></a>云函数Python处理图片代码</h5><p>这里的return没有使用集成响应的格式，如果勾选了集成响应会显示错误，集成响应的格式在官方文档的云函数API网关触发可以看到。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf8 -*-</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main_handler</span>(<span class="params">event, context</span>):</span></span><br><span class="line">    <span class="comment"># 处理传入的数据</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        body = event[<span class="string">&#x27;body&#x27;</span>]</span><br><span class="line">        data = json.loads(body)</span><br><span class="line">        file = data[<span class="string">&#x27;files&#x27;</span>][<span class="string">&#x27;file&#x27;</span>] <span class="comment">#文件</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;code&quot;</span>:<span class="number">500</span>,</span><br><span class="line">            <span class="string">&quot;msg&quot;</span>:<span class="string">&quot;文件为空&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 判断是否图片base64数据</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        img = re.sub(<span class="string">r&#x27;data:image/(jpeg|png|gif);base64,&#x27;</span>,<span class="string">&#x27;&#x27;</span>,file)<span class="comment">#去除文件类型</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;code&quot;</span>:<span class="number">501</span>,</span><br><span class="line">            <span class="string">&quot;msg&quot;</span>:<span class="string">&quot;这不是一张图片&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 写入到图片</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        imgdata = base64.b64decode(img)</span><br><span class="line">        file_path  = <span class="string">&#x27;/tmp/test.jpg&#x27;</span></span><br><span class="line">        fo = <span class="built_in">open</span>(file_path,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">        fo.write(imgdata)</span><br><span class="line">        fo.close()</span><br><span class="line">        <span class="comment"># 图片保存成功 云函数可以操作/tmp目录</span></span><br><span class="line">        <span class="comment"># 这里执行你的逻辑</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;code&quot;</span>:<span class="number">502</span>,</span><br><span class="line">            <span class="string">&quot;msg&quot;</span>:<span class="string">&quot;服务器保存图片错误&quot;</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h5 id="获取API网关访问路径"><a href="#获取API网关访问路径" class="headerlink" title="获取API网关访问路径"></a>获取API网关访问路径</h5><p><img src="https://i.loli.net/2021/11/15/jlh59bn2NqAIuYa.png" alt="image.png"></p><h3 id="iapp上传httpbin的回调数据到云函数"><a href="#iapp上传httpbin的回调数据到云函数" class="headerlink" title="iapp上传httpbin的回调数据到云函数"></a>iapp上传httpbin的回调数据到云函数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">t()</span><br><span class="line">&#123;</span><br><span class="line">  s api = <span class="string">&quot;http://httpbin.org/post&quot;</span></span><br><span class="line">  s tapi =<span class="string">&quot;https://iapi.1ove.icu/release/i-up-up&quot;</span></span><br><span class="line">  <span class="comment">//api网关的地址</span></span><br><span class="line">  s file = <span class="string">&quot;/storage/emulated/0/Pictures/WeiXin/1.jpg&quot;</span></span><br><span class="line">  <span class="comment">//上传的文件</span></span><br><span class="line">  s type = <span class="string">&quot;utf-8&quot;</span></span><br><span class="line">  <span class="comment">//上传到httpbin 传入 参数e</span></span><br><span class="line">  huf(api, <span class="string">&quot;&quot;</span> , file, type, e)</span><br><span class="line">  <span class="comment">//上传 参数e 到云函数</span></span><br><span class="line">  hs(tapi,e,type,ee)</span><br><span class="line">  <span class="comment">//ee 结果</span></span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/hexo/"/>
      <url>/hexo/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
